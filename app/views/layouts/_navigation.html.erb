<style>
.dropdown-menu > li > a {
  font-size: 12px;
  font-weight: bold;
}
.cart-btn {
  padding-top: 3% !important;
  margin-bottom: -88px !important;
}
</style>
<!-- <nav class="navbar navbar-default"> -->
<nav class="navbar navbar-expand-lg navbar-dark">
  

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-controls="bs-example-navbar-collapse-1" aria-expanded="false" aria-label="Toggle navigation">
     <span class="navbar-toggler-icon"></span>
   </button>
  <% if app_user_signed_in? %>
     
    <div class="container-fluid collapse navbar-collapse" id="responsive-nav">

      
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" >
        <%= form_tag(app_recipes_path(current_app), method: :get, remote: true, id: "frmRecipes") do |f| %> 
        <%= hidden_field_tag :filter, 1 %>
        <div class="navbar-header">
          
          <%= link_to t('navigation.home'), app_path(@current_app), class: "navbar-brand", id: "logo", style: "display: flex; justify-content: center; align-items: center;" %>
        </div>
        <ul class="nav navbar-nav flex-row mr-auto mt-2 mt-lg-0">
          
          <li class="active nav-item">
            <%= link_to app_recipes_path(@current_app), class: "btn btn-success" do %>
              <%= t('navigation.all_recipes') %><span class="sr-only">(current)</span>
            <% end %>
          </li>
           <li class="dropdown nav-item">
            <a href="#" class="dropdown-toggle btn btn-purple" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><%= t('navigation.styles')  %></a>
            <ul class="dropdown-menu">
              <% @all_styles.each do |style| %>
              <li class="nav-item">
                <a href="#" class='checkbox_anchor'>
                  <input id="<%= "checkbox_style_#{style.id}"%>" type="checkbox" name="style_ids[]" onclick="search()" class="styles" value="<%= style.id %>" <%= (params[:style_ids] && params[:style_ids].include?(style.id)) ? 'checked = true' : '' %> />
                  <label for="<%= "checkbox_style_#{style.id}"%>"><%= style.name %></label>
                </a>
              </li>
              
              <% end %>

              <% if current_app_user.admin?  || current_app_user.chef? %>
                <li role="separator" class="divider"></li>
                <li class="nav-item">
                  <%= link_to t('navigation.new_style'), new_app_style_path(@current_app) %>
                </li>
              <% end %>
              
            </ul>
          </li>
           <li class="dropdown nav-item">
            <a href="#" class="dropdown-toggle btn btn-purple" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><%= t('navigation.ingredients')%></a>
            <ul class="dropdown-menu">
              <% @all_ingredients.each do |ingredient| %>
              <li class="nav-item">
                <a href="#" class='checkbox_anchor'>
                  <input id="<%= "checkbox_ingredient_#{ingredient.id}"%>" type="checkbox" name="ingredient_ids[]" onclick="search()" class="ingredients" value="<%= ingredient.id %>" <%= (params[:ingredient_ids] && params[:ingredient_ids].include?(ingredient.id)) ? 'checked = true' : '' %> />
                  <label for="<%= "checkbox_ingredient_#{ingredient.id}"%>"><%= ingredient.name %></label>
                </a>
              </li>
              
              <% end %>

              <% if current_app_user.admin?  || current_app_user.chef? %>
                <li role="separator" class="divider"></li>
                <li class="nav-item">
                  <%= link_to t('navigation.new_ingredient'), new_app_ingredient_path(@current_app) %>
                </li>
              <% end %>
              
            </ul>
          </li>

            <li class="dropdown nav-item">
            <a href="#" class="dropdown-toggle btn btn-purple" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><%= t('navigation.allergens')  %></a>
            <ul class="dropdown-menu">
              <% @all_allergens.each do |allergen| %>
              <li class="nav-item">
                <a href="#" class='checkbox_anchor'>
                  <input id="<%= "checkbox_allergen_#{allergen.id}"%>" type="checkbox" name="allergen_ids[]" onclick="search()" class="allergens" value="<%= allergen.id %>" <%= (params[:allergen_ids] && params[:allergen_ids].include?(allergen.id)) ? 'checked = true' : '' %> />
                  <label for="<%= "checkbox_allergen_#{allergen.id}"%>"><%= allergen.name %></label>
                </a>
              </li>
              
              <% end %>

              <% if current_app_user.admin?  || current_app_user.chef? %>
                <li role="separator" class="divider"></li>
                <li class="nav-item">
                  <%= link_to t('navigation.new_allergen'), new_app_allergen_path(@current_app) %>
                </li>
                <% end %>
            </ul>
              <% if current_app_user.admin? || current_app_user.chef? %>
              <li class="nav-item">
                <%= link_to t('navigation.new_recipe'), new_app_recipe_path(@current_app), class: "btn btn-success" %>
              </li>
              <% end %>
              <li class="dropdown nav-item">
                <a href="#" class="dropdown-toggle btn btn-success" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><%= t('navigation.team') %></a>
                <ul class="dropdown-menu">
                  <% if current_app_user.admin?  %>
                  <li>
                    <%= link_to t('navigation.create_chef'), new_app_chef_path(@current_app) %>
                  </li>
                  <% end %>
                  <li>
                    <%= link_to t('navigation.list_chefs'), app_chefs_path(@current_app) %>
                  </li>
                </ul>
              </li>
          </li>
       </ul>
        
        <ul class="nav navbar-nav navbar-right">
          <li class="dropdown nav-item">
            <a href="#" class="dropdown-toggle btn btn-purple" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
              <%= current_app_user.first_name %></a>
            <ul class="dropdown-menu">
              
              <li>
                <%= link_to t('navigation.edit_profile'), current_app_user.chef? ? edit_app_chef_path(@current_app, current_app_user) : edit_app_user_registration_path(current_app_user) %>
              </li>
              <% if current_app_user.admin? %>
                <li>
                  <%= link_to t('navigation.guest_list'), app_guests_path(@current_app) %>
                </li>
                <li>
                  <%= link_to t('navigation.update_welcome_page'), welcome_edit_app_pages_path(@current_app) %>
                </li>
                <li>
                  <%= link_to t('navigation.update_about_us_page'), about_edit_app_pages_path(@current_app) %>
                </li>
              <% end %>
              <li role="separator" class="divider"></li>
              <li><%= link_to t('navigation.logout'), destroy_app_user_session_path, method: :delete %></li>
            </ul>
          </li>
        </ul>
        <% end %>
      </div>
    </div>
    
    <ul class="cart-btn nav navbar-nav">
      <li class="dropdown nav-item">
        <%= button_to t('recipes.my_cart'), app_cart_path(@current_app, id: @current_cart.id), class: "btn btn-purple", method: :get, disabled: @current_cart.line_items.count == 0 %>
      </li>
    </ul>
  <% else %>
    <div class="row" style="width: 100%;">
      <div class="col-md-8"></div>
      
        <div class="col-md-4 login">
          <div class="login">
            <%= link_to t('navigation.login'), new_app_user_session_path(@current_app), class: 'btn btn-success btn-lg'%>
          </div>
          <div class="registration">
            <%= link_to t('navigation.sign_up'), new_app_user_registration_path(@current_app), class: 'btn btn-success btn-lg'%>
          </div>
        </div>
        
      </div>
  <% end %>
</nav> 
<script type="text/javascript">
  $.fn.toggleCheck  =function() {
    if(this.tagName === 'INPUT') {
      $(this).prop('checked', !($(this).is(':checked')));
    }

  }
  function search() {
    var style_ids = $("input[class=styles]:checked").map(function () {
        return $(this).val();
    }).get();
    console.log(style_ids);

    var ingredient_ids = $("input[class=ingredients]:checked").map(function () {
        return $(this).val();
    }).get();
    console.log(ingredient_ids);

    var allergens_ids = $("input[class=allergens]:checked").map(function () {
        return $(this).val();
    }).get();

    console.log(allergens_ids);

    $('#frmRecipes').submit();

  }

  $('.checkbox_anchor').on('click', function(e) {
    e.stopPropagation();
    var target = e.target
    var input = $(target).children('input')
    var checked = $(input).prop( "checked")
    $(input).trigger("click")
  })
  
</script>
