<style>
  .bottom-line{
    background-color: lightgray;
  }
  .agreement-btn{
    font-size: 18px;
    width: 150px !important;
  }
  .agreement-checkBox{
    height: 40px;
    width: 40px;
  }
  input{
    font-size: 16px !important;
  }
  @media screen and (max-width: 600px) {
    .agreement-checkBox{
      width: 100%;
    }
  }
  @media screen and (max-width: 950px) {
    .agree-section{
      justify-content: center;
      margin-bottom: 10px;
    }
  }
  /* Dropdown CSS Start */
  .collapsible-item-title-link-icon{
    display: none;
  }
  .panel-default{
    border: none;
    box-shadow: none;
  }
  .panel-heading{
    border: none;
    background: none !important;
  }
  .panel-title{
    text-align: center;
  }
  .panel-title a{
    color: #007bff !important;
    text-decoration: none;
  }
  .collapsible-item-title-link svg{
    margin-left: 5px;
  }
  /* Dropdown CSS End */
</style>

<%= form_with(model: Agreement.new, url: app_agreements_path(current_app), html: { id: "agreement_form" }) do |f| %>
  <div class="container mb-5">
    <div class="row mt-5">
      <div class="col-md-12">
        <%= Style.agreement_style.agreement_text&.html_safe %>
        <div class="mt-5">
          <%= f.hidden_field :style_id, value: Style.agreement_style.id %>
          <div class="row mt-3">
            <div class="col-md-6">
              <%= f.email_field :email , placeholder: t('agreement.email'), class:"ml-3 form-control", required: true %>
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-md-6">
              <%= f.text_field :first_name , placeholder:t('agreement.first_name'), class:"ml-3 form-control", required: true %>
            </div>
          </div>
          <div class="row mt-3 pb-4">
            <div class="col-md-6">
              <%= f.text_field :last_name , placeholder:t('agreement.last_name'), class:"ml-3 form-control", required: true %>
            </div>
          </div>

          <h2 class="mt-5">
            <%= t('agreement.under_18_age') %>
          </h2>
          <div class="row ">
            <div class="col-md-6">
              <%= f.email_field :guardian_email , placeholder:t('agreement.guardian_email'), class:"ml-3 form-control", required: true %>
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-md-6">
              <%= f.text_field :guardian_first_name , placeholder:t('agreement.guardian_first_name'), class:"ml-3 form-control", required: true %>
            </div>
          </div>
          <div class="row mt-3 pb-5">
            <div class="col-md-6">
              <%= f.text_field :guardian_last_name , placeholder:t('agreement.guardian_last_name'), class:"ml-3 form-control", required: true %>
            </div>
          </div>

          <div  class="row mt-5 text-center pb-5">
            <div class="col-12">
              <h1>
                <%= t('agreement.terms_agreement') %>
              </h1>
            </div>
            <div class="col-12 d-lg-flex justify-content-center">
              <div class="d-sm-flex agree-section">
                <h2 class="mr-lg-3 my-auto">
                  <%= t('agreement.agree') %>
                </h2>
                <%= check_box_tag 'agree', 'false', false, class: 'agreement-checkBox' %>
              </div>
              <%= f.submit t('agreement.submit') , id:"Submit-btn", class:"ml-3 agreement-btn btn btn-success btn-lg p-3 text-white w-100", disabled: true%>
              <a class="border agreement-btn btn btn-secondary btn-lg text-white w-100 ml-3 p-3 clear-btn">
                <%= t('agreement.clear_form') %>
              </a>
              <a  href="<%= table_app_styles_path(current_app) %>" class="border agreement-btn btn btn-danger btn-lg text-white w-100 ml-3 p-3">
                <%= t('agreement.cancel') %>
              </a>
            </div>
          </div>
        </div>
        <div class="row mt-5">
          <div class="col-12 text-center border bottom-line">
            <h2>
              <%= t('agreement.agreement_copy') %>
            </h2>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div>
    <div class="captcha_sub_signup mb-5 mt-5" style="text-align: center;">
      <div class="g-recaptcha g-recaptcha--left" style="display: inline-block;" data-sitekey="6LddIlEgAAAAALvk31bD1M0FZ2bMDqcm6U2Qbk2M" data-callback="get_action" ></div>
      <span id="captcha" style="color:red;" />
    </div>
  </div>
<% end %>

<script src="https://www.google.com/recaptcha/api.js" async defer></script>
<script>
  $('.agreement-checkBox').click(function() {
    if ($(this).is(':checked') && ($('#Submit-btn').attr("recaptcha") == 'true')) {
      $('#Submit-btn').attr("disabled", false);
    } else {
      $('#Submit-btn').attr("disabled", true);
    }
  });

  $('.clear-btn').click(function() {
    $('#Submit-btn').attr("disabled", true);
    $("#agreement_form").trigger("reset");
  })

  function get_action(form) {
    var v = grecaptcha.getResponse();
    if(v.length == 0) {
      $('#Submit-btn').attr("recaptcha", false);
      $('#Submit-btn').attr("disabled", true);
    } else if ($('.agreement-checkBox').is(':checked')) {
      console.log("vl", v, "vl.l", v.length);
      $('#Submit-btn').attr("disabled", false);
    } else {
      $('#Submit-btn').attr("recaptcha", true);
    }
  };
</script>
