<style>
  .form-control {
    font-size: 12px;
  }
  .cart-functional {
    padding-top: 6px;
    border-top: 4px solid green;
  }
  table {
    font-family: Helvetica, sans-serif;
    width: 100%;
    margin: 0;
    padding: 0;
    table-layout: fixed;
  }
  td, th {
    text-align: center;
    vertical-align: middle;
    border: 1px solid #dadada;
    font-size: 1.2em;
  }
  thead {
    font-weight: bold;
    font-size: 1.2em;
  }
  .empty-row {
    height: 20px;
    border: none;
  }
  .add-coupon {
    border: none;
  }
  .empty-header {
    border: none;
  }
  .coupon-code-input {
    width: 97%;
  }
  .tax-input {
   text-align: center;
   margin-left: 15px;
 }
 .delivery-input {
   text-align: center;
 }
 .coupon-active {
    width: 30px;
    height: 30px;
 }
 .coupon-code-input {
   text-align: center;
 }
</style>

<%= render 'shared/errors', obj: @user %>

<div class="row">
    <%= form_for(@user, url: !@user.id.nil? ? app_chef_path(current_app, @user) : app_chefs_path, :html => {class: "form-horizontal autosave", role: "form",  multipart: true }) do |f| %>
    <div class="col-md-offset-4 login-sec margin-sec full-width-sec edit-chef">
      <div class="col-md-offset-5">
        <%= render partial: 'shared/form_locale_selector', locals: {model: "ingredient", elem: "chef"} %>
      </div>
      <div class="col-md-5 well box-content">
      
        <div class="form-group">
          <div class="control-label col-md-2">
            <%= f.label :first_name, t('forms.first_name') %>
          </div>
          <div class="col-md-8">
            <%= f.text_field :first_name, class: "form-control", placeholder: t('forms.enter_first_name'), autofocus: true %>
          </div>
        </div>
        <div class="form-group">
          <div class="control-label col-md-2">
            <%= f.label :last_name, t('forms.last_name') %>
          </div>
          <div class="col-md-8">
            <%= f.text_field :last_name, class: "form-control", placeholder:  t('forms.enter_last_name'), autofocus: true %>
          </div>
        </div>
        <% if @user.admin? %>
          <%= f.fields_for :app do |ff| %>
            <div class="form-group">
              <div class="control-label col-md-2">
                <%= f.label :slug, "URL slug" %>
              </div>
              <div class="col-md-8">
                <%= ff.text_field :slug, class: "form-control", placeholder: "Enter last your url slug", autofocus: true %>
              </div>
            </div>
          <% end %>
        <% end %>
        <div class="form-group">
          <div class="control-label col-md-2">
            <%= f.label :email %>
          </div>
          <div class="col-md-8">
            <%= f.email_field :email, class: "form-control", placeholder:  t('forms.enter_email') %>
          </div>
        </div>
        <div class="form-group input-group show-password" style="width: auto;">
          <div class="control-label col-md-2">
            <%= f.label :password, t('forms.password') %>
          </div>
          <div class="col-md-8">
            <%= f.password_field :password, class: "form-control col-md-10", placeholder: t('forms.choose_password') %>
            <div class='input-group-addon' style="height: 34px;">
              <a href="" class="toggle-password">
                <%= fa_icon "eye" %>
              </a>
            </div>
          </div>
        </div>
        <div class="form-group">
          <div class="control-label col-md-2">
            <%= f.label :password, t('forms.password') %>
          </div>
          <div class="col-md-8">
            <%= f.password_field :password, class: "form-control", placeholder: t('forms.choose_password') %>
          </div>
        </div>
      <% if current_app_user.admin? %>
        
        <div class="form-group cart-functional">
        <h3 style="text-align: center; padding-bottom: 10px;"><%= t('chefs.cart_func') %></h3>
          <div class="control-label col-md-2">
            <%= f.label :product_tax, t('chefs.product_tax') + ' %' %>
          </div>
          <div class="col-md-2">
            <%= f.number_field :product_tax, value: number_to_currency(current_app_user.product_tax.to_f, delimiter: '', unit: ''), class: "tax-input form-control", step: 0.01, min: 0, max: 100 %>
          </div>
          <div class="control-label col-md-3" style="margin-left: 30px;">
            <%= f.label :delivery_price, t('chefs.delivery_price') + ' $' %>
          </div>
          <div class="col-md-2">
            <%= f.number_field :delivery_price, value: number_to_currency(current_app_user.delivery_price.to_f, delimiter: '', unit: ''), class: "delivery-input form-control", step: 5, min: 0, max: 10 %>
          </div>
        </div>

        <div class="form-group">
          <div class="control-label col-md-2">
            <%= f.label :paypal_client_id, 'PayPal client-id' %>
          </div>
          <div class="col-md-8">
            <%= f.text_field :paypal_client_id, value: current_app_user.paypal_client_id, class: "form-control" %>
          </div>
        </div>

        <div class="form-group">
          <div class="control-label col-md-2">
            <%= f.label :paypal_client_secret, 'PayPal client-secret' %>
          </div>
          <div class="col-md-8">
            <%= f.password_field :paypal_client_secret, value: current_app_user.paypal_client_secret, class: "form-control" %>
          </div>
        </div>
      <% end %>
      </div>

      <div class="col-md-5 well box-content">
      <%= f.fields_for :chef_info, @user.chef_info do |c| %>
        <% I18n.available_locales.each do |locale| %>
            <div class="form-group <%= "chef_#{locale}" %>">
              <div class="col-md-12" style="font-weight:bold;">
                <%= c.label :my_bio, t('chefs.add_summary_bio') + "(#{locale})" %>
              </div>
              <div class="col-md-12">
                
                <%= c.cktext_area "my_bio_#{locale}", class: "form-control", placeholder: "" %>
              </div>
            </div>
          <% end %>
        <%= c.hidden_field :admin_id, value: current_app_user.id %>
        <div class="form-group">
          <p style="text-align: center; font-size: 10px;"><%= t('recipes.max_pic_size', mb: 5) %><br><%= t('recipes.rec_pic_size') %></p>
          <div class='row'>
            <div class="control-label col-md-2"></div>
            <div class="control-label col-md-2"></div>
            <div class="control-label col-md-8">
              <%= c.file_field :chef_avatar, accept: 'image/jpeg,image/gif,image/png' %>
            </div>
          </div>
          <div class='row'>
            <div class="col-md-12">
              <%= image_tag((!@user.nil? && !@user.chef_info.nil? && @user.chef_info.chef_avatar.attached?) ? @user.chef_info.chef_avatar : 'cooking-new.png', class: 'img-responsive', alt: t('common.no_image'), size: "1366x768") %>
            </div>
          </div>
        </div>
      <% end %>

        <div class="form-group">
          <div class="col-md-2 col-md-offset-2">
            <% if current_app_user.admin? %>
            <%= link_to t('chefs.delete_profile'), [current_app, @user.chef_info], class: "btn btn-danger delete-btn btn-lg",  method: :delete, data: { confirm: t('chefs.confirm_delete_account') } %>
            <% end %>
          </div>
          <div class="col-md-offset-2 col-md-4">
            <%= f.submit(@user.new_record? ? t('chefs.create_account') : t('chefs.update_account'), 
                                                      class: "btn btn-primary btn-lg btn-xlarge", style: "float:right;") %>
          </div>
        </div>
    <% end %>

    <% if current_app_user&.admin? %>
      <table>
        <h3 style="text-align: center;"><%= t('recipes.coupone_code') %></h3>
        <thead>
          <tr>
            <td colspan="3"><%= t('chefs.coupon_title') %></td>
            <td colspan="2"><%= t('chefs.coupon_percent_off') %></td>
            <td colspan="2"><%= t('chefs.coupon_active') %></td>
            <td class="empty-header"></td>
          </tr>
        </thead>
        <tbody>
        <% current_app_user.chef_info.coupon_codes.each do |coupon_code| %>
          <tr>
            <td colspan="3"><%= coupon_code.title %></td>
            <td colspan="2"><%= coupon_code.coupon_percent_off %></td>
            <td colspan="2"><%= coupon_code.is_active %></td>
            <td class="empty-header"><%= button_to "x", app_coupon_codes_path(current_app, code_id: coupon_code.id), class: "btn btn-outline-danger", remote: true, method: :delete %></td>
          </tr>
        <% end %>

        <%= form_for :coupon_code, url: app_add_coupon_codes_path(current_app), html: { method: :post } do |coupon_code| %>
          <tr>
            <td class="empty-row"></td>
          </tr>
          <tr>
            <td colspan="3" class="add-coupon"><%= coupon_code.text_field :title, class: "form-control coupon-code-input", id: "coupon-title", placeholder: t('recipes.coupone_code') %></td>
            <td colspan="2" class="add-coupon"><%= coupon_code.number_field :coupon_percent_off, class: "form-control coupon-code-input", step: 0.01, min: 0, max: 100 %></td>
            <td colspan="2" class="add-coupon"><%= coupon_code.check_box :is_active, class: "coupon-active" %></td>
            <td colspan="1" class="add-coupon"><%= coupon_code.submit "Add", class: "btn btn-success btn-lg", id: "add-coupon-btn", disabled: true %></td>
          <tr>
        <% end %>
        </tbody>
      </table>

      <table>
        <h3 style="text-align: center; border-top: 1px solid #dadada; margin-top: 20px;"><%= t('recipes.fundraising_code') %></h3>
        <thead>
          <tr>
            <td colspan="3"><%= t('chefs.coupon_title') %></td>
            <td colspan="2"><%= t('chefs.coupon_active') %></td>
            <td class="empty-header"></td>
          </tr>
        </thead>
        <tbody>
        <% current_app_user.chef_info.fundrasing_codes.each do |fundrasing_code| %>
          <tr>
            <td colspan="3"><%= fundrasing_code.title %></td>
            <td colspan="2"><%= fundrasing_code.is_active %></td>
            <td class="empty-header"><%= button_to "x", app_fundrasing_codes_path(current_app, code_id: fundrasing_code.id), class: "btn btn-outline-danger", remote: true, method: :delete %></td>
          </tr>
        <% end %>

        <%= form_for :fundrasing_code, url: app_add_fundrasing_codes_path(current_app), html: { method: :post } do |fundrasing_code| %>
          <tr>
            <td class="empty-row"></td>
          </tr>
          <tr>
            <td colspan="3" class="add-coupon"><%= fundrasing_code.text_field :title, class: "form-control coupon-code-input", id: "fundrasing-title", placeholder: t('recipes.fundraising_code') %></td>
            <td colspan="2" class="add-coupon"><%= fundrasing_code.check_box :is_active, class: "coupon-active" %></td>
            <td colspan="1" class="add-coupon"><%= fundrasing_code.submit "Add", class: "btn btn-success btn-lg", id: "add-fundrasing-btn", disabled: true %></td>
          <tr>
        <% end %>
        </tbody>
      </table>
    <% end %>
    </div>

    <div class="col-md-4 col-md-offset-4 colormatch">
      [ <%= link_to t('forms.return_to_recipes'), app_recipes_path(current_app) %> ]
    </div>
  
</div>

<script type="text/javascript">
  var couponTitleValue = document.getElementById("coupon-title");
  var addCouponBtn = document.getElementById("add-coupon-btn");
  var fundrasingTitleValue = document.getElementById("fundrasing-title");
  var addFundrasingBtn = document.getElementById("add-fundrasing-btn");

  couponTitleValue.addEventListener("change", function () {
      if (couponTitleValue.value.length > 0) {
      addCouponBtn.disabled = false;
      } else {
      addCouponBtn.disabled = true;
      }
  });

  fundrasingTitleValue.addEventListener("change", function () {
      if (fundrasingTitleValue.value.length > 0) {
      addFundrasingBtn.disabled = false;
      } else {
      addFundrasingBtn.disabled = true;
      }
  });
</script>


