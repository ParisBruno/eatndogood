<style>
  .form-control {
    font-size: 13px;
    font-weight: 600;
    color: black;
  }
  .cart-functional {
    padding-top: 6px;
    border-top: 4px solid green;
  }
  .coupon-codes, .fundraising-codes {
    margin-left: 7%;
    max-width: 590px;
  }
  table {
    font-family: Helvetica, sans-serif;
    width: 100%;
    margin: 0;
    padding: 0;
    table-layout: fixed;
  }
  td, th {
    text-align: center;
    vertical-align: middle;
    border: 1px solid #dadada;
    font-size: 1.2em;
  }
  thead {
    font-weight: bold;
    font-size: 1.2em;
  }
  .empty-row {
    height: 20px;
    border: none;
  }
  .add-coupon {
    border: none;
  }
  .empty-header {
    border: none;
  }
  .coupon-code-input {
    width: 97%;
  }
  @media screen and (min-width: 1024px) {
    .tax-input, .delivery-input {
      width: auto;
      min-width: 50%;
    }
  }
  @media screen and (max-width: 320px) {
    .small-label {
      font-size: 10px !important;
    }
  }
 .coupon-active {
    width: 30px;
    height: 30px;
 }
 .manager-check {
    width: 30px;
    height: 30px;
    margin-top: -5px !important;
 }
 .coupon-code-input {
   text-align: center;
 }
  .form-horizontal .checkbox-inline {
    padding-top: 0;
    padding-right: 10px;
  }
  .languages-btn {
    font-size: 15px;
    font-weight: 500;
    color: black;
  }
  input[type=checkbox].checkbox-inline {
    transform: scale(1.3);
    margin-right: 10px;
  }
  .dropdown .languages-dropdown {
    right: unset;
  }
  .languages-dropdown li label{
    font-size: 17px;
  }
  .margin-sec .box-content{
    float: unset;
  }
  .form-group {
    margin-left: 0 !important;
    margin-right: 0 !important;
  }
  @media screen and (min-width: 768px) {
    .left-btn {
      padding-left: 8px;
    }
  }
  @media screen and (max-width: 768px) {
    .form-horizontal {
      padding: 50px !important;
    }
    .login-sec form {
      margin-bottom: unset;
    }
    #coupon-check-box {
      width: 25px;
    }
    #add-coupon-btn {
      padding: 4px;
    }
  }
  @media screen and (max-width: 550px) {
    .form-group .control-label{
      margin-left: 25px;
    }
    .form-group .col-md-8{
      padding: 0 23px;
    }
    .chef_en .col-md-12 {
      padding: 0 20px;
    }
    .left-btn, .right-btn {
      text-align: center;
      margin-bottom: 5px;
    }
  }
  .form-group.input-group {
    padding: 0 15px;
  }

  #paypal-btn{
    background: #ffc439;
    border: #ffc439;
    height: 47px;
  }
  .payment-option{
    height: 47px;
  }
  #venmo-btn{
    height: 47px;
    background: #009cde;
    border: #009cde;
  }
  @media screen and (max-width: 768px) {
    .payment-btns {
      width: 100% !important;
    }
  }
  .payment-btns {
    padding: 0 15px;
    width: 50%;
  }
  #stripe-btn {
    font-size: 38px;
    font-weight: 800;
    line-height: 3px;
  }
</style>

<%= render 'shared/errors', obj: @user %>
<% @current_app_user = current_app_user %>
<% @current_app = current_app %>

<div class="row">
  <%= form_for(@user, url: !@user.id.nil? ? app_chef_path(current_app, @user) : app_chefs_path, :html => {class: "form-horizontal autosave p-0", role: "form",  multipart: true }) do |f| %>
    <div class="col-md-offset-4 login-sec margin-sec full-width-sec edit-chef">
      <div class="col-md-6 well box-content">
        <div class="mt-3">
          <% if @user.admin? %>
            <li class="dropdown nav-item list-unstyled">
              <a href="#" class="dropdown-toggle btn languages-btn" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><%= t('forms.select_language') %></a>
              <ul class="dropdown-menu languages-dropdown">
                <% @available_locales.each do |style| %>
                  <li class="nav-item">
                    <a href="#" class='checkbox_anchor'>
                      <input id="<%= "user_app_attributes_selected_languages_#{style.first}"%>" type="checkbox" name="user[app_attributes][selected_languages][]" class="checkbox-inline input_checkbox" value="<%= style.first %>" <%= (@current_app.selected_languages.include?(style.first)) ? 'checked = true' : '' %> />
                      <label for="<%= "user_app_attributes_selected_languages_#{style.first}"%>"><%= style.last %></label>
                    </a>
                  </li>
                <% end %>
              </ul>
            </li>
          <% end %>
          <%= render partial: 'shared/form_locale_selector', locals: {model: "ingredient", elem: "chef"} %>
        </div>
        <div class="cart-functional"></div>
        <div class="mt-3 form-group col-12">
          <div class="">
            <%= f.text_field :first_name, class: "form-control", placeholder: t('forms.first_name'), autofocus: true %>
          </div>
        </div>
        <div class="form-group col-12">
          <div class="">
            <%= f.text_field :last_name, class: "form-control", placeholder:  t('forms.last_name'), autofocus: true %>
          </div>
        </div>
        <% if @user.admin? %>
          <%= f.fields_for :app do |ff| %>
            <div class="form-group col-12">
              <div class="">
                <%= ff.text_field :slug, class: "form-control", placeholder: t('forms.url_slug'), autofocus: true %>
              </div>
            </div>
          <% end %>
        <% end %>
        <div class="form-group col-12">
          <div class="">
            <%= f.email_field :email, class: "form-control", placeholder:  t('forms.email') %>
          </div>
        </div>
        <div class="form-group input-group mb-3 show-password">
          <%= f.password_field :password, class: "form-control", placeholder: t('forms.password') %>
          <div class="input-group-append">
            <span class="input-group-text" id="basic-addon2">
              <a href="" class="toggle-password">
                <%= fa_icon "eye" %>
              </a>
            </span>
          </div>
        </div>
        <div class="form-group col-12">
          <div class="">
            <%= f.password_field :password_confirmation, class: "form-control", placeholder: t('forms.password_confirmation') %>
          </div>
        </div>
        <% if @current_app_user != @user %>
          <div class="form-group col-12">
            <div class="">
              <%= f.text_field :title, class: "form-control", placeholder: t('forms.title') %>
            </div>
          </div>
          <div class="row">
            <div class="form-group col-1">
              <%= f.check_box :manager, class: "manager-check" %>
            </div>
            <div class="form-group col-11">
              <%= f.label :manager, 'Manager' %>
            </div>
          </div>
          <div class="form-group col-12">
            <div class="">
              <%= f.select :manager_id, current_app.users.managers.collect  {|p| [p.full_name, p.id] }, { prompt: t('forms.manager_for_staff') }, class: 'form-control form-control-lg' %>
            </div>
          </div>
        <% end %>
        <% if @current_app_user == @user && @current_app_user&.admin? && @current_app_user == @current_app.main_admin %>
          <div class="cart-functionalities">
            <div class="cart-functional">
              <h3 style="text-align: center; padding-bottom: 10px;" class="mt-3">
                <%= t('chefs.cart_func') %>
              </h3>
              <div class="row col-4">
                <li class="dropdown nav-item list-unstyled mb-3">
                  <a href="#" class="dropdown-toggle btn languages-btn" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><%= t('forms.select_payment_method') %></a>
                  <ul class="dropdown-menu w-100">
                    <% payment_methods.each do |payment_method| %>
                      <li class="nav-item">
                        <a href="#" class='checkbox_anchor'>
                          <input id="<%= "user_selected_payment_methods_#{payment_method}"%>" type="checkbox" name="user[selected_payment_methods][]" class="checkbox-inline input_checkbox" value="<%= payment_method %>" <%= (@user.selected_payment_methods.include?(payment_method)) ? 'checked = true' : '' %> />
                          <label for="<%= "user_app_attributes_selected_payment_methods_#{payment_method}"%>"><%= payment_method.capitalize %></label>
                        </a>
                      </li>
                    <% end %>
                  </ul>
                </li>
              </div>
            </div>
            <!-- Payment Options Start -->
            <div class="form-group payment-btns">
              <button type="button" class="btn btn-success btn-lg w-100 my-2" id="paypal-btn">
                <img src="/assets/paypal-logo.svg">
              </button>
              <button type="button" class="btn-lg w-100 mb-2" id="venmo-btn">
                <img src="/assets/venmo-logo.svg">
              </button>
              <button type="button" class="btn btn-primary btn-lg mb-2 w-100 payment-option" id="stripe-btn">
                <div><%= t('orders.stripe') %><div>
              </button>
            </div>
            <!-- Payment Options End -->

            <div class="form-group row col-12">
              <div class="col-6 pl-0 d-lg-flex">
                <%= f.label :product_tax, t('chefs.product_tax'), class: "mt-lg-2 small-label" %>
                <%= f.number_field :product_tax, value: number_to_currency(@current_app_user.product_tax.to_f, delimiter: '', unit: ''), class: "tax-input form-control ml-lg-4", step: 0.01, min: 0, max: 100 %>
              </div>
              <div class="col-6 pr-0 d-lg-flex">
                <%= f.label :delivery_price, t('chefs.delivery_price') + ' $', class: "mt-lg-2 small-label" %>
                <%= f.number_field :delivery_price, value: number_to_currency(@current_app_user.delivery_price.to_f, delimiter: '', unit: ''), class: "delivery-input form-control ml-lg-4", step: 5, min: 0, max: 10 %>
              </div>
            </div>
            <div id="paypal-fields" class="d-none">
              <div class="form-group col-12">
                <div class="">
                  <%= f.text_field :paypal_client_id, value: @current_app_user.paypal_client_id, class: "form-control", placeholder: t('forms.paypal_client_id') %>
                </div>
              </div>
              <div class="form-group col-12">
                <div class="">
                  <%= f.text_field :paypal_client_secret, class: "form-control", placeholder: t('forms.paypal_client_secret') %>
                </div>
              </div>
            </div>
            <div id="stripe-fields" class="d-none">
              <div class="form-group col-12">
                <div class="">
                  <%= f.text_field :stripe_publishable_key, class: "form-control", placeholder: t('forms.stripe_publishable_key') %>
                </div>
              </div>
              <div class="form-group col-12">
                <div class="">
                  <%= f.text_field :stripe_secret_key, class: "form-control", placeholder: t('forms.stripe_secret_key') %>
                </div>
              </div>
            </div>
            <div class="form-group col-12">
              <div>
                <%= f.text_field :business_name, class: "form-control", placeholder: t('forms.business_name') %>
              </div>
            </div>
            <div class="form-group col-12">
              <div class="">
                <%= f.text_field :store_address, class: "form-control", placeholder: t('forms.store_address') %>
              </div>
            </div>
            <div class="form-group col-12">
              <div class="">
                <%= f.text_field :phone, class: "form-control", placeholder: t('orders.phone') %>
              </div>
            </div>
            <div class="form-group col-12">
              <div class="">
                <%= f.cktext_area :greeting_message, class: "form-control", placeholder: t('forms.greeting_message') %>
              </div>
            </div>
          </div>
          <div class="cart-functional mb-4">
            <div class="coupon-codes">
              <%= render partial: 'coupon_codes_table' %>
            </div>
          </div>
          <div class="cart-functional mb-4">
            <div class="fundraising-codes">
              <%= render partial: 'fundraising_codes_table' %>
            </div>
          </div>
        <% end %>
      </div>
      <div class="col-md-4 well box-content p-3">
        <%= f.fields_for :chef_info, @user.chef_info do |c| %>
          <% [I18n.locale].each do |locale| %>
            <div class="form-group <%= "chef_#{locale}" %>">
              <div class="col-md-12" style="font-weight:bold;">
                <%= c.label :my_bio, t('chefs.add_summary_bio') + "(#{locale})" %>
              </div>
              <div class="col-md-12">
                <%= c.cktext_area "my_bio_#{locale}", class: "form-control", placeholder: "" %>
              </div>
            </div>
          <% end %>
          <%= c.hidden_field :admin_id, value: @current_app_user.id %>
          <div class="form-group col-12">
            <p style="text-align: center; font-size: 10px;"><%= t('recipes.max_pic_size', mb: 5) %><br><%= t('recipes.rec_pic_size') %></p>
            <div class='row'>
              <div class="control-label col-md-2"></div>
              <div class="control-label col-md-2"></div>
              <div class="control-label col-md-8 mb-4">
                <%= c.file_field :chef_avatar, accept: 'image/jpeg,image/gif,image/png' %>
              </div>
            </div>
            <div class='row'>
              <div class="col-md-12">
                <%= image_tag((!@user.nil? && !@user.chef_info.nil? && @user.chef_info.chef_avatar.attached?) ? @user.chef_info.chef_avatar : 'cooking-new.png', class: 'img-responsive', alt: t('common.no_image'), size: "1366x768") %>
              </div>
            </div>
          </div>
        <% end %>
        <div class="form-group">
          <div class="col-md-12">
            <div class="row">
              <div class="col-md-offset-2 col-lg-4 col-md-7 left-btn col-sm-12">
                <%= f.submit(@user.new_record? ? t('chefs.create_account') : t('chefs.update_account'), 
                                                          class: "btn btn-primary btn-lg btn-xlarge") %>
              </div>
              <div class="col-lg-2 col-md-4 col-md-offset-2 right-btn col-sm-12">
                <% if @current_app_user.admin? %>
                  <%= link_to t('chefs.delete_profile'), [current_app, @user.chef_info], class: "btn btn-danger delete-btn btn-lg",  method: :delete, data: { confirm: t('chefs.confirm_delete_account') } %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>
<div class="row">
  <div class="col-12 text-center colormatch mt-5">
    [ <%= link_to t('forms.return_to_recipes'), app_recipes_path(@current_app) %> ]
  </div>
</div>

<script type="text/javascript">
  var checkLanguages = document.querySelectorAll('[id ^= "user_app_attributes_selected_languages_"]')

  checkLanguages.forEach(event => {
    if (event.checked) {
      if (event.value.includes('_primary')) {
        event.style.accentColor = 'lime';
      } else {
        event.style.accentColor = 'blue';
      }
    }
  })

  checkLanguages.forEach(event => {
    event.addEventListener('change', () => {
      selectedLanguages = checkSelectedLanguage();
      
      if (event.checked) {
        if (selectedLanguages.length < 2) {
          event.value += "_primary"
          event.style.accentColor = 'lime';
        } else {
          event.value += "_secondary"

          event.style.accentColor = 'blue';
        }
      } else {
        selectedPrimary = checkPrimaryLanguage(selectedLanguages);
        event.value = event.value.substring(0,2);
        
        if(selectedPrimary.length < 1) {
          if (selectedLanguages.length >= 1) {
            selectedLanguages[0].style.accentColor = 'lime';
            selectedLanguages[0].value = selectedLanguages[0].value.substring(0,2);
            selectedLanguages[0].value += "_primary"
          }
        }
      }
    })
  })

  function checkSelectedLanguage() {
    var values = [];
    for(var i = 0; i < checkLanguages.length; i++) {
      if (checkLanguages[i].checked) {
        values.push(checkLanguages[i]);
      }
    }
    return values
  }

  function checkPrimaryLanguage(selected) {
    var values = [];
    for(var i = 0; i < selected.length; i++) {
      if (selected[i].value.includes('_primary')) {
        console.log('GGG', selected[i].value)
        values.push(selected[i].value);
      }
    }
    return values
  }

  $(document).ready(function() {
    var timer = setInterval(function () {
      var editor = $('.cke').length
      if (editor != 0) {
        var templateIcon = '<svg id="editorTemplateIcon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark" viewBox="0 0 16 16"><path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/></svg>'
        var leftIcon = '<svg id="editorLeftIcon" class="ck ck-icon ck-button__icon" viewBox="0 0 20 20"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 4c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75z"></path></svg>'
        var centerIcon = '<svg id="editorCenterIcon" class="ck ck-icon ck-button__icon" viewBox="0 0 20 20"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm2.286 4c0 .414.336.75.75.75h9.928a.75.75 0 1 0 0-1.5H5.036a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h9.928a.75.75 0 1 0 0-1.5H5.036a.75.75 0 0 0-.75.75z"></path></svg>'
        var rightIcon = "<svg id='editorRightIcon' class='ck ck-icon ck-button__icon' viewBox='0 0 20 20'><path d='M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 4c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75z'></path></svg>"
        var blockIcon = '<svg id="editorBlockIcon" class="ck ck-icon ck-button__icon" viewBox="0 0 20 20"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 4c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75z"></path></svg>'
        var collapseIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrows-expand" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 8zM7.646.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 1.707V5.5a.5.5 0 0 1-1 0V1.707L6.354 2.854a.5.5 0 1 1-.708-.708l2-2zM8 10a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L7.5 14.293V10.5A.5.5 0 0 1 8 10z"/></svg>'
        var colorIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-palette" viewBox="0 0 16 16"> <path d="M8 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM5.5 7a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm.5 6a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"/> <path d="M16 8c0 3.15-1.866 2.585-3.567 2.07C11.42 9.763 10.465 9.473 10 10c-.603.683-.475 1.819-.351 2.92C9.826 14.495 9.996 16 8 16a8 8 0 1 1 8-8zm-8 7c.611 0 .654-.171.655-.176.078-.146.124-.464.07-1.119-.014-.168-.037-.37-.061-.591-.052-.464-.112-1.005-.118-1.462-.01-.707.083-1.61.704-2.314.369-.417.845-.578 1.272-.618.404-.038.812.026 1.16.104.343.077.702.186 1.025.284l.028.008c.346.105.658.199.953.266.653.148.904.083.991.024C14.717 9.38 15 9.161 15 8a7 7 0 1 0-7 7z"/> </svg>'
        var bgColorIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-palette-fill" viewBox="0 0 16 16"> <path d="M12.433 10.07C14.133 10.585 16 11.15 16 8a8 8 0 1 0-8 8c1.996 0 1.826-1.504 1.649-3.08-.124-1.101-.252-2.237.351-2.92.465-.527 1.42-.237 2.433.07zM8 5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm4.5 3a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zM5 6.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm.5 6.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"/> </svg>'
        $('.cke_button__templates_icon').each(function() {
          $( this ).prepend(templateIcon);
        });
        $('.cke_button__justifyleft').each(function() {
          $( this ).prepend(leftIcon);
        });
        $('.cke_button__justifycenter').each(function() {
          $( this ).prepend(centerIcon);
        });
        $('.cke_button__justifyright').each(function() {
          $( this ).prepend(rightIcon);
        });
        $('.cke_button__justifyblock').each(function() {
          $( this ).prepend(blockIcon);
        });
        $('.cke_button__collapsibleitem').each(function() {
          $( this ).prepend(collapseIcon);
        });
        $('.cke_button__textcolor_icon').each(function() {
          $( this ).prepend(colorIcon);
        });
        $('.cke_button__bgcolor_icon').each(function() {
          $( this ).prepend(bgColorIcon);
        });
        clearInterval(timer);
      }
    }, 500);

    $("#paypal-btn, #venmo-btn").click(function(){
      $('#paypal-fields').removeClass('d-none');
      $('#stripe-fields').addClass('d-none');
    });

    $("#stripe-btn").click(function(){
      $('#paypal-fields').addClass('d-none');
      $('#stripe-fields').removeClass('d-none');
    });
  });
</script>
