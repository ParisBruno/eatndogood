<style type="text/css">
  .full-width-sec {    float: none;
      margin: 0 auto;
      display: inline-block;
      text-align: center;
    }
  .full-width-sec .box-content {    float: none;
      display: inline-block; text-align: left;
      vertical-align: top;
      margin: 0 1%;}
  .full-width-sec .recepie-menu {width: 100%;}
  .full-width-sec .label label {font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      font-size: 14px; font-weight: bold;
      line-height: 1.428571429;
      color: #333333;}
  .recipi-main {margin-top: 60px;}
  #recipe_price {
    max-width: 100px;
    text-align: center;
    font-size: 14px;
    padding: 5px 10px;
    border-radius: 4px;
  }
  #recipe_subcategory_id {
    text-align: center;
    font-size: 14px;
    padding: 10px 5px;
    border-radius: 4px;
    border: 2px inset grey;
  }
  @media screen and (max-width: 768px) {
    .form-horizontal {
      padding: 20px !important;
    }
    .recepie-menu{
      padding: 5px !important;
    }
    .recepie-menu #save-button {
      margin-bottom: 5px;
    }
  }
</style>
<%= render 'shared/errors', obj: @recipe %>

<div class="row">
  <div class="margin-sec receipy-top-sec custom-new-form" style="padding: 20px;">
    <div class=" col-md-offset-4 login-sec margin-sec full-width-sec">
    <%= form_for([current_app, @recipe], html: { multipart: true, class: "form-horizontal autosave" }) do |f| %>
      <%= render partial: 'shared/form_locale_selector', locals: {model: "recipe", elem: "group"} %>
      <div class="col-lg-6  col-md-5 col-ms-12 col-xs-12  well box-content">
        <% I18n.available_locales.each do |locale| %>
          <div class="<%= "group_#{locale}" %>">
            <div class="form-group col-12">
              <div class=" col-md-12">
                <%= f.label :name, t('forms.name') + "(#{locale})" %>
              </div>
              <div class="col-md-12">
                <%= f.text_field "name_#{locale}", class: "form-control", placeholder: t('recipes.write_name'), autofocus: true %>
              </div>
            </div>
            <div class="form-group col-12">
              <div class=" col-md-12">
                <%= f.label :summary, t('forms.summary') + "(#{locale})" %>
              </div>
              <div class="col-md-12">
                <%= f.cktext_area "summary_#{locale}", rows: '2', cols: 50, class: "form-control", placeholder: t('recipes.summary_placeholder'), autofocus: true %>
                <p style="color:red;"><%= t('common.note_allow_chars', from: 10, to: 500) %></p>
              </div>
            </div>
            <div class="form-group col-12">
              <div class=" col-md-12">
                <%= f.label :description, t('forms.description') + "(#{locale})" %>
              </div>
              <div class="col-md-12">
                <%= f.cktext_area "description_#{locale}", cols: 50, class: "form-control", placeholder: t('recipes.description_placeholder'), autofocus: true %>
                <p style="color:red;"><%= t('common.note_allow_chars', from: 20, to: 3000) %></p>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <div class="col-lg-5  col-md-5 col-ms-12 col-xs-12 well box-content rht-box-sec">

        <div class="form-group col-12 recepie-menu" id='recipe_all_styles'>
          <div class="col-md-12">
            <%= f.label :styles, t('forms.styles') %> &nbsp; <a href="#" class='new_elem_recipe' data-toggle="modal" data-target="#new_style_modal">[<%= t('forms.new_style') %>]</a>
          </div>
          <div class="col-md-12">
            <%= f.collection_check_boxes :style_ids, Style.where(:app_id => current_app.id).all, :id, :name do |cb| %>
              <% cb.label(class: "checkbox-inline input_checkbox") {cb.check_box(class: "checkbox") + cb.text.capitalize} %>
            <% end %>
            
          </div>
        </div>

        <div class="form-group col-12 recepie-menu"  id='recipe_all_ingredients'>
          <div class="col-md-12">
            <%= f.label :ingredients, t('forms.ingredients') %> &nbsp; <a href="#"  class='new_elem_recipe' data-toggle="modal" data-target="#new_ingredient_modal">[<%= t('forms.new_ingredient') %>]</a>
          </div>
          <div class="col-md-12">
            <%= f.collection_check_boxes :ingredient_ids, current_app.ingredients, :id, :name do |cb| %>
              <% cb.label(class: "checkbox-inline input_checkbox") {cb.check_box(class: "checkbox") + cb.text.capitalize} %>
            <% end %>
          </div>
        </div>
        <div class="form-group col-12 recepie-menu" id='recipe_all_allergens'>
          <div class="col-md-12">
            <%= f.label :allergens, t('forms.allergens') %> &nbsp; <a href="#" class='new_elem_recipe' data-toggle="modal" data-target="#new_allergen_modal">[<%= t('forms.new_allergen') %>]</a>
          </div>
          <div class="col-md-12">
            <%= f.collection_check_boxes :allergen_ids, Allergen.where(:app_id => current_app.id).all, :id, :name do |cb| %>
              <% cb.label(class: "checkbox-inline input_checkbox") {cb.check_box(class: "checkbox") + cb.text.capitalize} %>
            <% end %>
          </div>
        </div>

        <div class="form-group col-12 recepie-menu">
          <div class="col-md-12">
            <%= f.label :images, t('recipes.upload_food_pic') %>
          </div>
          <div class="col-md-12">
            <% if @recipe.food_image.attached? %>
              <% image = @recipe.sized(:food_image, :thumb) %>
              <%=image_tag(image, class:'img', alt: t('common.no_image')) if image.present? %>
            <% end %>
            <%= f.file_field "food_image", type: :file, accept: 'image/jpeg,image/gif,image/png' %>
            <bold style="margin-left: 5%;"><%= t('recipes.max_pic_size', mb: 5) %></bold>
          </div>
        </div>

        <div class="form-group col-12 recepie-menu">
          <div class="col-md-12">
            <%= f.label :price, t('recipes.price') %>
            <%= f.number_field :price, value: number_to_currency(f.object.price.to_f, delimiter: '', unit: ''), step: 0.01, min: 0 %>
          </div>
        </div>
        <div class="recepie-menu btn form-group">
          <div class="row">
            <%= f.submit t('recipes.save_submit'), class: "btn btn-success btn-lg col-lg-8 col-sm-12", id: "save-button" %>
            <%= f.submit t('recipes.save_draft'), class: "btn btn-outline-success btn-lg col-lg-3 col-sm-12", id: "draft-button" %>
          </div>
        </div>
      </div>
    <% end %>
    </div>
    <div class="col-12 colormatch text-center mt-5">
      [ <%= link_to t('forms.return_to_recipes'), app_recipes_path(current_app) %> ]
    </div>
    <!-- style modal -->
    <div class='modal fade' id='new_style_modal' tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title" id="modalLabel">Modal Title</h4>
          </div>
          <div class='modal-body'>
            <%= render 'styles/form', remote: true %>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!-- ingredient modal -->
    <div class='modal fade' id='new_ingredient_modal' tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title" id="modalLabel">Modal Title</h4>
          </div>
          <div class='modal-body'>
            <%= render 'ingredients/form', remote: true %>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Allergens modal -->
    <div class='modal fade' id='new_allergen_modal' tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title" id="modalLabel">Modal Title</h4>
          </div>
          <div class='modal-body'>
            <%= render 'allergens/form', remote: true %>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script type="text/javascript">
  var draftButton = document.getElementById("draft-button");
  var saveButton = document.getElementById("save-button");

  saveButton.disabled = true;
  draftButton.disabled = true;

  var currentLocaleLoad = document.getElementById("recipe_locale");
  var recipeNameLoad = document.getElementById("recipe_name_" + currentLocaleLoad.value);
  var recipeDescriptionLoad = document.getElementById("recipe_description_" + currentLocaleLoad.value);
  if (recipeNameLoad.value.length > 2 && recipeDescriptionLoad.value.length > 0) {
      saveButton.disabled = false;
      draftButton.disabled = false;
  } else {
      saveButton.disabled = true;
      draftButton.disabled = true;
  }

  document.body.addEventListener("mouseup", function () {
    var currentLocale = document.getElementById("recipe_locale");
    var recipeName = document.getElementById("recipe_name_" + currentLocale.value);
    var recipeDescription = document.getElementById("recipe_description_" + currentLocale.value);
    if (recipeName.value.length > 2 && recipeDescription.value.length > 0) {
        saveButton.disabled = false;
        draftButton.disabled = false;
    } else {
        saveButton.disabled = true;
        draftButton.disabled = true;
    }
  })

  $(document).ready(function() {
    $("footer").removeClass('fixed-footer');
    $('#new_style').on('ajax:success', function(e, data, status, xhr) {
      $('#recipe_all_styles').load('<%= new_app_recipe_path(current_app)%> #recipe_all_styles')
      $('#new_style_modal').modal('hide')
    })
    $('#new_ingredient').on('ajax:success', function(e, data, status, xhr) {
      $('#recipe_all_ingredients').load('<%= new_app_recipe_path(current_app)%> #recipe_all_ingredients')
      $('#new_ingredient_modal').modal('hide')
    })
    $('#new_allergen').on('ajax:success', function(e, data, status, xhr) {
      $('#recipe_all_allergens').load('<%= new_app_recipe_path(current_app)%> #recipe_all_allergens')
      $('#new_allergen_modal').modal('hide')
    })

    var timer = setInterval(function () {
      var editor = $('.cke').length
      if (editor != 0) {
        var templateIcon = '<svg id="editorTemplateIcon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark" viewBox="0 0 16 16"><path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/></svg>'
        var leftIcon = '<svg id="editorLeftIcon" class="ck ck-icon ck-button__icon" viewBox="0 0 20 20"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 4c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75z"></path></svg>'
        var centerIcon = '<svg id="editorCenterIcon" class="ck ck-icon ck-button__icon" viewBox="0 0 20 20"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm2.286 4c0 .414.336.75.75.75h9.928a.75.75 0 1 0 0-1.5H5.036a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h9.928a.75.75 0 1 0 0-1.5H5.036a.75.75 0 0 0-.75.75z"></path></svg>'
        var rightIcon = "<svg id='editorRightIcon' class='ck ck-icon ck-button__icon' viewBox='0 0 20 20'><path d='M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 4c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75z'></path></svg>"
        var blockIcon = '<svg id="editorBlockIcon" class="ck ck-icon ck-button__icon" viewBox="0 0 20 20"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 4c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75z"></path></svg>'

        $('.cke_button__templates_icon').each(function() {
          $( this ).prepend(templateIcon);
        });
        $('.cke_button__justifyleft').each(function() {
          $( this ).prepend(leftIcon);
        });
        $('.cke_button__justifycenter').each(function() {
          $( this ).prepend(centerIcon);
        });
        $('.cke_button__justifyright').each(function() {
          $( this ).prepend(rightIcon);
        });
        $('.cke_button__justifyblock').each(function() {
          $( this ).prepend(blockIcon);
        });
        clearInterval(timer);
      }
    }, 500);
  });

  $('#recipe_picture').bind('change', function(){
   var _URL = window.URL || window.webkitURL;
    size_in_megabytes = this.files[0].size/2048/2048;
    if (size_in_megabytes > 1) {
        $(this).val('');
      alert('Maximum file size is 5MB. Please choose a smaller file.')
    }

    var file, img;
    if ((file = this.files[0])) {
        img = new Image();
        img.onload = function () {
            if(this.width < 500 && this.height < 600) {
              //alert(this.width + " " + this.height);
              alert('Please provide image atleast 500*600 dimensions!');
              $('#recipe_picture').val('');
            }
        };
        img.src = _URL.createObjectURL(file);

    }

  });

  $('#recipe_drinkpic').bind('change', function(){

    var _URL = window.URL || window.webkitURL;
    size_in_megabytes = this.files[0].size/2048/2048;
    if (size_in_megabytes > 1) {
        $(this).val('');
      alert('Maximum file size is 5MB. Please choose a smaller file.')
    }

    var file, img;
    if ((file = this.files[0])) {
        img = new Image();
        img.onload = function () {
            if(this.width < 500 && this.height < 600) {
              //alert(this.width + " " + this.height);
              alert('Please provide image atleast 500*600 dimensions!');
              $('#recipe_drinkpic').val('');
            }
        };
        img.src = _URL.createObjectURL(file);

    }
  });

  function loadEditor(id)
  {
    var instance = CKEDITOR.instances[id];
    if(instance)
    {
      console.log('should remove', id)
      CKEDITOR.remove(instance);
    }
    CKEDITOR.replace(id,  {
      extraPlugins: 'placeholder',
    });
  }

  $('#recipe_all_styles input[type=checkbox]').change(function(){
    if($(this).is(':checked')){
  $('#recipe_all_styles input[type=checkbox]').attr('disabled', true);
      $(this).attr('disabled', false);
  }
    else{
    $('#recipe_all_styles input[type=checkbox]').attr('disabled', false);
      }
  });
</script>



