<style>
  #checkout-button {
      min-width: 300px;
  }
  .content {
    padding: 10px;
  }
  .row > form {
    padding: 10px;
  }
  table {
    font-family: Helvetica, sans-serif;
    width: 100%;
    margin: 0;
    padding: 0;
    table-layout: fixed;
  }
  td, th {
    text-align: left;
    vertical-align: middle;
    border: 1px solid #dadada;
  }
  thead {
    font-size: 1.4em;
  }
  .list-header {
    padding: 2px;
    padding-left: 5px;
  }
  .product-item {
    padding: 5px;
    font-size: 1.3em;
  } 
  .total-item {
    font-size: 1.3em;
    font-weight: bold;
    padding: 5px;
    text-align: center;
  }
  .subtotal {
    width: 80%;
    border: none;
    text-align: right;
  }
  .subtotal-price {
    border: none;
    border-bottom: 1px solid black;
    text-align: center;
  }
  .form-control {
    font-size: 1.3em;
    text-align: center;
  }
  .order-table {
    border: none;
  }
  .checkout {
    margin-top: 10px;
    font-size: 1.6em;
  }
  .order-button {
    border: none;
  }
  .order {
    float: right;
    margin-top: 5px;
  }
  .email-to {
    border: none;
    font-size: 0.9em;
  }
</style>
 <section>
      <div class="product">
        <img
          src="https://i.imgur.com/EHyR2nP.png"
          alt="The cover of Stubborn Attachments"
        />
        <div class="description">
          <h3>Stubborn Attachments</h3>
          <h5>$20.00</h5>
        </div>
      </div>
      <button id="checkout-button">Checkout</button>
    </section>
  <div class="row">
      <%= form_for(@order, url: app_orders_path(current_app), html: { method: :post }) do |f| %>
      <div class="col-md-offset-4 login-sec margin-sec full-width-sec edit-chef">
        <div class="col-md-5 well box-content">  
          <table>
            <tr>
              <td class="order-table">
                <div class="form-group">
                  <div class="control-label col-md-2">
                    <%= f.label :name, t('orders.full_name') %><br>
                  </div>
                  <div class="col-md-8">
                    <%= current_app_user.full_name %>
                    <%= f.text_field :name, required: true, autofocus: true, class: "form-control" %><br>
                  </div>
                </div>
              </td>
            </tr>
            <tr>
              <td class="order-table">
                <div class="form-group">
                  <div class="control-label col-md-2">
                    <%= current_app_user.email %>
                    <%= f.label :email, t('orders.email') %><br>
                  </div>
                  <div class="col-md-8">
                    <%= f.email_field :email, class: "form-control" %><br>
                  </div>
                </div>
              </td>
            </tr>
            <tr>
              <td class="order-table">
                <div class="form-group">
                  <div class="control-label col-md-2">
                    <%= f.label :phone, t('orders.phone') %><br>
                  </div>
                  <div class="col-md-8">
                    <%= f.text_field :phone, class: "form-control", placeholder: t('orders.phone') %><br>
                  </div>
                </div>
              </td>
            </tr>
            <tr>
              <td class="order-table">
                <div class="form-group">
                  <div class="control-label col-md-2">
                    <%= f.label :home_address, t('orders.home_address') %><br>
                  </div>
                  <div class="col-md-8">
                    <%= f.text_field :address, class: "form-control", placeholder: t('orders.home_address') %></p>
                  </div>
                </div>
              </td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>


<div class="row">
  <div class="col-md-offset-4 login-sec margin-sec full-width-sec edit-chef">
    <div class="col-md-5 well box-content">
      <table>
        <thead>
          <tr>
            <td colspan="4" class="list-header"><%= t('orders.list_products') %></td>
          </tr>
        </thead>
        <tbody>
        <% @current_cart.line_items.order(:created_at).each do |line_item| %>  
          <tr>
            <td colspan="3" class="product-item">
              <%= line_item.recipe.name %>, <%= line_item.quantity %>x<%= number_to_currency(line_item.recipe.price) %>
            </td>
            <td class="total-item"><%= "%0.2f" % (line_item.quantity * line_item.recipe.price.to_f) %>$ </td>
          </tr>
        <% end %>
        </tbody>
      </table>

      <table class="checkout">
        <tr>
          <td class="subtotal"><%= t('orders.subtotal') %>: </td>
          <td class="subtotal-price"><%= number_to_currency(@current_cart.sub_total) %></td>
        </tr>
        <tr>
          <td class="subtotal"><%= t('orders.tax') %>: </td>
          <td class="subtotal-price"><%= number_to_currency(@current_cart.sub_total) %></td>
        </tr>
        <tr>
          <td class="subtotal"><%= t('orders.total') %>: </td>
          <td class="subtotal-price"><%= number_to_currency(@current_cart.sub_total + @current_cart.sub_total) %></td>
        </tr>


        <tr>
          <td colspan="1" class="email-to">Receipt: Email to <b><%= current_app_user.email %></b> or Print: (dropdown list of printers)</td>
          <td colspan="1" class="order-button"><%= button_to t('orders.send'), new_app_order_path(current_app), class: "order btn btn-primary btn-lg", method: :get, disabled: @current_cart.line_items.count == 0 %></td>
        </tr>
      </table>
   <% end %>
    </div>
   
  </div>
</div>

<script src="https://js.stripe.com/v3/"></script>

<script type="text/javascript">
 

// Set your publishable key: remember to change this to your live publishable key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
// var stripe = Stripe('pk_test_51Hkyh8JhzcOxD4pH4Fb5eqzK9MTDNFq8OUfRGjyOdTDbeYKNI8wcR714tB9bv0MBCQZP3mI1a0a2v1a31lSbVsLH00VXfz5uOg');
// var elements = stripe.elements();
    // Create an instance of the Stripe object with your publishable API key
    var stripe = Stripe("pk_test_51Hkyh8JhzcOxD4pH4Fb5eqzK9MTDNFq8OUfRGjyOdTDbeYKNI8wcR714tB9bv0MBCQZP3mI1a0a2v1a31lSbVsLH00VXfz5uOg");
    var checkoutButton = document.getElementById("checkout-button");
    checkoutButton.addEventListener("click", function () {
      fetch("/create-session", {
        method: "POST",
      })
        .then(function (response) {
          return response.json();
        })
        .then(function (session) {
          return stripe.redirectToCheckout({ sessionId: session.id });
        })
        .then(function (result) {
          // If redirectToCheckout fails due to a browser or network
          // error, you should display the localized error message to your
          // customer using error.message.
          if (result.error) {
            alert(result.error.message);
          }
        })
        .catch(function (error) {
          console.log("Error:", error);
        });
    });
</script>