CKEDITOR.plugins.add("panelbutton",{requires:"button",onLoad:function(){function n(t){var e=this._;e.state!=CKEDITOR.TRISTATE_DISABLED&&(this.createPanel(t),e.on?e.panel.hide():e.panel.showBlock(this._.id,this.document.getById(this._.id),4))}CKEDITOR.ui.panelButton=CKEDITOR.tools.createClass({base:CKEDITOR.ui.button,$:function(t){var e=t.panel||{};delete t.panel,this.base(t),this.document=e.parent&&e.parent.getDocument()||CKEDITOR.document,e.block={attributes:e.attributes},e.toolbarRelated=!0,this.hasArrow="listbox",this.click=n,this._={panelDefinition:e}},statics:{handler:{create:function(t){return new CKEDITOR.ui.panelButton(t)}}},proto:{createPanel:function(e){var n=this._;if(!n.panel){var t=this._.panelDefinition,o=this._.panelDefinition.block,a=t.parent||CKEDITOR.document.getBody(),s=this._.panel=new CKEDITOR.ui.floatPanel(e,a,t),i=s.addBlock(n.id,o),l=this,d=e.getCommand(this.command);s.onShow=function(){l.className&&this.element.addClass(l.className+"_panel"),l.setState(CKEDITOR.TRISTATE_ON),n.on=1,l.editorFocus&&e.focus(),l.onOpen&&l.onOpen()},s.onHide=function(t){l.className&&this.element.getFirst().removeClass(l.className+"_panel"),!l.modes&&d?l.setStateFromCommand(d):l.setState(l.modes&&l.modes[e.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),n.on=0,!t&&l.onClose&&l.onClose()},s.onEscape=function(){s.hide(1),l.document.getById(n.id).focus()},this.onBlock&&this.onBlock(s,i),i.onHide=function(){n.on=0,!l.modes&&l.command?l.setStateFromCommand(d):l.setState(CKEDITOR.TRISTATE_OFF)}}},setStateFromCommand:function(t){this.setState(t.state)}}})},beforeInit:function(t){t.ui.addHandler(CKEDITOR.UI_PANELBUTTON,CKEDITOR.ui.panelButton.handler)}}),CKEDITOR.UI_PANELBUTTON="panelbutton";