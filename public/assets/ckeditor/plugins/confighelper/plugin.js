/**
 * @file Configuration helper plugin for CKEditor
 * Copyright (C) 2012 Alfonso MartÃ­nez de Lizarrondo
 *
 */
!function(){"use strict";function e(e){if(!e)return!0;if(e.length>20)return!1;var t=e.replace(/[\n|\t]*/g,"").toLowerCase();return!t||"<br>"==t||"<p>&nbsp;<br></p>"==t||"<p><br></p>"==t||"<div><br></div>"==t||"<p>&nbsp;</p>"==t||"&nbsp;"==t||" "==t||"&nbsp;<br>"==t||" <br>"==t}function t(t){var n=t.editor;if(!n.readOnly){var o=n.editable(),i=t.listenerData;if(o){if("wysiwyg"==n.mode){if(CKEDITOR.dialog._.currentTop)return;if(!o)return;e(o.getHtml())&&(o.setHtml(i),o.addClass("placeholder"))}if("source"==n.mode){if(a)return void("mode"==t.name&&o.setAttribute("placeholder",i));e(o.getValue())&&(o.setValue(i),o.addClass("placeholder"))}}}}function n(e){var t=e.editor,n=t.editable();if(n){if("wysiwyg"==t.mode){if(!n.hasClass("placeholder"))return;if(n.removeClass("placeholder"),CKEDITOR.dtd[n.getName()].p){var o="";t.enterMode===CKEDITOR.ENTER_P?o="<p><br/></p>":t.enterMode===CKEDITOR.ENTER_DIV?o="<div><br/></div>":(o="<br/>",(CKEDITOR.env.gecko||CKEDITOR.env.ie)&&(o=" ")),n.setHtml(o);var i=new CKEDITOR.dom.range(t.document);i.moveToElementEditablePosition(n.getFirst(),!0),t.getSelection().selectRanges([i])}else n.setHtml(" ")}if("source"==t.mode){if(!n.hasClass("placeholder"))return;n.removeClass("placeholder"),n.setValue("")}}}function o(e){e.editor.readOnly?n(e):t(e)}function i(e){return e?e.getAttribute("lang")||i(e.getParent()):null}var a="placeholder"in document.createElement("textarea");CKEDITOR.plugins.add("confighelper",{getPlaceholderCss:function(){return".placeholder{ color: #999; }"},onLoad:function(){CKEDITOR.addCss(this.getPlaceholderCss())},init:function(l){function r(e){if(l==e.editor){var t,n,o,i,a,r=e.data.name,s=e.data.definition;if("tableProperties"==r&&(r="table"),"removeDialogFields"in l._||!l.config.removeDialogFields||(l._.removeDialogFields=u(l.config.removeDialogFields)),l._.removeDialogFields&&(t=l._.removeDialogFields[r]))for(o in t)if(i=t[o],a=s.getContents(o))for(n=0;n<i.length;n++)a.remove(i[n]);if("hideDialogFields"in l._||!l.config.hideDialogFields||(l._.hideDialogFields=u(l.config.hideDialogFields)),l._.hideDialogFields&&(t=l._.hideDialogFields[r]))for(o in t)if(i=t[o],a=s.getContents(o))for(n=0;n<i.length;n++)a.get(i[n]).hidden=!0;if(l.config.dialogFieldsDefaultValues&&(t=l.config.dialogFieldsDefaultValues[r]))for(o in t)if(i=t[o],a=s.getContents(o))for(var d in i){var f=a.get(d);f&&(f["default"]=i[d])}}}l.on("mode",function(e){e.editor.focusManager.hasFocus=!1});var s=l.element.getAttribute("placeholder")||l.config.placeholder;if(s){var d=CKEDITOR.document.getHead().append("style");d.setAttribute("type","text/css");var f="textarea.placeholder { color: #999; font-style: italic; }";CKEDITOR.env.ie&&CKEDITOR.env.version<11?d.$.styleSheet.cssText=f:d.$.innerHTML=f,l.on("getData",function(e){var t=l.editable();t&&t.hasClass("placeholder")&&(e.data.dataValue="")}),l.on("setData",function(n){if(!(CKEDITOR.dialog._.currentTop||"source"==l.mode&&a)){var o=l.editable();o&&(e(n.data.dataValue)?t(n):o.hasClass("placeholder")&&o.removeClass("placeholder"))}}),l.on("blur",t,null,s),l.on("mode",t,null,s),l.on("contentDom",t,null,s),l.on("focus",n),l.on("key",n),l.on("beforeModeUnload",n),l.on("readOnly",o,null,s)}var c=l.config.contentsLanguage||i(l.element);if(c&&l.plugins.scayt&&!l.config.scayt_sLang){try{localStorage&&localStorage.removeItem("scayt_0_lang")}catch(p){}var g={en:"en_US","en-us":"en_US","en-gb":"en_GB","pt-br":"pt_BR",da:"da_DK","da-dk":"da_DK","nl-nl":"nl_NL","en-ca":"en_CA","fi-fi":"fi_FI",fr:"fr_FR","fr-fr":"fr_FR","fr-ca":"fr_CA",de:"de_DE","de-de":"de_DE","el-gr":"el_GR",it:"it_IT","it-it":"it_IT","nb-no":"nb_NO",pt:"pt_PT","pt-pt":"pt_PT",es:"es_ES","es-es":"es_ES","sv-se":"sv_SE"};l.config.scayt_sLang=g[c.toLowerCase()]}var u=function(e){if("object"==typeof e)return e;var t,n=e.split(";"),o={};for(t=0;t<n.length;t++){var i=n[t].split(":");if(3==i.length){var a=i[0],l=i[1],r=i[2];o[a]||(o[a]={}),o[a][l]||(o[a][l]=[]),o[a][l].push(r)}}return o};CKEDITOR.on("dialogDefinition",r),l.once("beforeDestroy",function(){CKEDITOR.removeListener("dialogDefinition",r)})}})}();